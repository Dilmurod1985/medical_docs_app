# OCR-система медицинских документов

Система для автоматической обработки медицинских документов с использованием OCR-технологий.

## Архитектура проекта

```
medical_docs_app/
├── main.py                 # Основной файл с пайплайном обработки
├── app.py                  # Веб-интерфейс на Streamlit
├── requirements.txt        # Зависимости проекта
├── utils/                  # Утилиты
│   ├── __init__.py
│   └── image_preprocessing.py  # Предобработка изображений
├── ocr/                    # OCR-модуль
│   ├── __init__.py
│   └── ocr_engine.py       # Движок OCR на базе EasyOCR
├── parser/                 # Парсер данных
│   ├── __init__.py
│   └── parser.py           # Парсинг медицинских данных
├── exporter/               # Экспорт результатов
│   ├── __init__.py
│   └── exporter.py         # Экспорт в Excel
├── photos/                 # Папка для исходных изображений
├── processed_images/       # Папка для обработанных изображений
└── output/                 # Папка для результатов
```

## Установка и запуск

### Вариант 1: Консольное приложение

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Поместите изображения медицинских документов в папку `photos/`

3. Запустите обработку:
```bash
python main.py
```

### Вариант 2: Веб-интерфейс (рекомендуется)

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Запустите веб-приложение:
```bash
streamlit run app.py
```

3. Откройте браузер по адресу `http://localhost:8501`

4. Загрузите изображения через веб-интерфейс и нажмите "Начать обработку"

## Функциональность

### 1. Предобработка изображений (`utils/image_preprocessing.py`)
- Адаптивный порог для удаления теней
- Уменьшение шума
- Морфологические операции для улучшения контуров

### 2. OCR-распознавание (`ocr/ocr_engine.py`)
- Использование EasyOCR для извлечения текста
- Поддержка языков: узбекский ('uz') и русский ('ru')
- Фильтрация по уровню уверенности

### 3. Парсинг данных (`parser/parser.py`)
- Поиск дат в формате DD.MM.YYYY
- Расчет даты следующего осмотра (+6 месяцев)
- Извлечение информации о пациенте

### 4. Экспорт результатов (`exporter/exporter.py`)
- Сохранение данных в Excel формат
- Автоматическая настройка ширины колонок
- Создание сводных отчетов

### 5. Веб-интерфейс (`app.py`)
- Удобный интерфейс на Streamlit
- Загрузка файлов через браузер
- Интерактивная таблица с результатами
- Скачивание Excel файла одним кликом

## Результаты работы

После обработки система создает:
- Обработанные изображения в папке `processed_images/`
- Excel файл с результатами в папке `output/`
- Сводный отчет по всем документам

## Структура выходных данных

Excel файл содержит следующие поля:
- `document_id` - ID документа
- `filename` - Имя файла
- `processing_date` - Дата обработки
- `patient_name` - Имя пациента
- `birth_date` - Дата рождения
- `age` - Возраст
- `exam_date` - Дата осмотра
- `next_exam_date` - Дата следующего осмотра
- `exam_number` - Номер осмотра в документе

## Особенности

- Автоматическое создание необходимых папок
- Поддержка различных форматов изображений (JPG, PNG, BMP, TIFF)
- Обработка ошибок и логирование
- Устойчивость к теням и шумам на изображениях